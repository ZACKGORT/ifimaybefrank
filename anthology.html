<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Anthology - A Cinematic Social Platform">
    <title>Anthology ¬∑ @zackgort</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,500;0,600;1,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
:root {
    --bg-color: #000000;
    --ink: #ffffff;
    --ink-2: #b8b8b8;
    --ink-3: #808080;
    --accent: #daa520;
    --curve-k: 1;
    --vig-opacity: 0.85;
    --vig-inner: 30%;
    --vig-mid: 75%;
    --vig-outer: 100%;
    --edge-blur: 6px;
    --edge-mask-i: 65%;
    --edge-mask-o: 80%;
    --z-content: 0;
    --z-grain: 149;
    --z-blur: 150;
    --z-vig: 151;
    --z-ui: 220;
    --z-overlay: 300;
    --z-dropdown: 350;
    --z-rail: 210;
    --z-mobile-bottom-rail: 220;
    --z-rotate-warning: 9999;
    --bracket-color: #8b6f47;
    --bracket-hover: #daa520;
    --bracket-bg: rgba(218, 165, 32, 0.04);
    
    --text-parallax-strength: 0.03;
    --image-parallax-strength: 0.15;
    --center-magnet-strength: 0.25;
}

html, body {
    overscroll-behavior: none;
    touch-action: pan-y;
}

body.layout-layered .text-layer {
    width: 95%;
    margin: 0 auto;
    max-width: 1400px;
}

body.layout-layered .stream {
    color: rgba(255, 255, 255, 0.85);
}

body.layout-layered .hover-image {
    position: absolute;
    left: 50%;
    top: 50%;
}

body.layout-split .text-layer {
    width: 50%;
    margin: 0;
    padding-left: 6vw;
}

body.layout-split .stream {
    color: rgba(255, 255, 255, 0.9);
    font-size: clamp(16px, 2vw, 28px);
}

body.layout-split .hover-image {
    position: fixed;
    left: 72%;
    top: 50%;
    width: 45vw;
    height: 34vw;
}

body:not(.cursor-preview-mode) .hover-image {
    display: block;
}

body:not(.cursor-preview-mode) #cursorImage {
    display: none !important;
}

body.cursor-preview-mode .hover-image {
    display: none !important;
}

body.cursor-preview-mode #cursorImage {
    display: block !important;
}

/* Right Rail Navigation (Desktop) */
.scroll-progress {
    position: fixed;
    right: 30px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    z-index: var(--z-ui);
    pointer-events: auto;
}

.scroll-progress-bar-container {
    width: 2px;
    height: 200px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 1px;
    position: relative;
    margin: 10px 0;
}

.scroll-progress-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background: var(--accent);
    border-radius: 1px;
    transition: height 0.3s ease;
}

.nav-button {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--ink-3);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    pointer-events: auto;
}

.nav-button:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: var(--accent);
    color: var(--accent);
    transform: scale(1.1);
}

.nav-button:active {
    transform: scale(0.95);
}

.nav-button svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
}

/* Left Rail (Permanent Lens Control) */
.left-rail {
    position: fixed;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    z-index: var(--z-rail);
    padding: 20px 12px;
    pointer-events: auto;
    display: flex;
    align-items: center;
}

.lens-control-container {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-left: none;
    border-radius: 0 8px 8px 0;
    padding: 16px 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    backdrop-filter: blur(5px);
}

.lens-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--ink-3);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    transform: rotate(180deg);
}

.lens-slider-wrapper {
    width: 8px;
    height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.lens-slider {
    -webkit-appearance: none;
    appearance: none;
    width: 140px;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    outline: none;
    transform: rotate(-90deg);
}

.lens-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(0,0,0,0.5);
}

.lens-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
    border: 1px solid rgba(0,0,0,0.5);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

/* Mobile Rails */
.mobile-bottom-rail {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding: 12px 20px;
    z-index: var(--z-mobile-bottom-rail);
    pointer-events: auto;
}

.mobile-nav-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    max-width: 500px;
    margin: 0 auto;
    width: 100%;
}

.mobile-nav-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.mobile-nav-button {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: var(--accent);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
    -webkit-tap-highlight-color: transparent;
}

.mobile-nav-button:active {
    transform: scale(0.92);
    background: rgba(218, 165, 32, 0.15);
}

.mobile-nav-button.mini {
    width: 40px;
    height: 40px;
}

.mobile-nav-button svg {
    width: 22px;
    height: 22px;
    fill: currentColor;
}

.mobile-nav-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--ink-3);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.mobile-progress-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 0 12px;
}

.mobile-progress-text {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--ink-2);
    letter-spacing: 0.05em;
}

.mobile-progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    position: relative;
    overflow: hidden;
}

.mobile-progress-fill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.3s ease;
    width: 0%;
}

body.image-active .sentence:not(.active) {
    opacity: 0.1;
    color: rgba(255, 255, 255, 0.3);
}

body.image-active .sentence.active {
    opacity: 1;
    color: #fff;
}

body.image-active .sentence.dimmed {
    opacity: 0.05;
    color: rgba(255, 255, 255, 0.15);
}

*, *::before, *::after { box-sizing: border-box; }
html { color-scheme: dark; -webkit-text-size-adjust: 100%; }
body, html { height: 100%; margin: 0; overflow-x: hidden; }

body {
    background: var(--bg-color);
    color: var(--ink);
    font: 18px/1.8 'Crimson Text', Georgia, serif;
    overflow: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    cursor: none;
}

body::-webkit-scrollbar { display: none; }
body { -ms-overflow-style: none; scrollbar-width: none; }
::selection { background: rgba(218, 165, 32, 0.25); color: #fff; }

.edge-blur {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: var(--z-blur);
    backdrop-filter: blur(var(--edge-blur));
    -webkit-backdrop-filter: blur(var(--edge-blur));
    mask: radial-gradient(100% 64% at 50% 50%, transparent var(--edge-mask-i), rgb(255 255 255 / 0.98) var(--edge-mask-o));
    -webkit-mask: radial-gradient(100% 64% at 50% 50%, transparent var(--edge-mask-i), rgb(255 255 255 / 0.98) var(--edge-mask-o));
}

.vignette {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: var(--z-vig);
    background: radial-gradient(120% 90% at 50% 50%, #fff0 var(--vig-inner), rgb(0 0 0 / 0.55) var(--vig-mid), rgb(0 0 0 / 0.9) var(--vig-outer));
    opacity: calc(var(--vig-opacity) * var(--curve-k));
}

body::after {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: var(--z-grain);
    opacity: 0.08;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.45'/%3E%3C/svg%3E");
    background-size: 120px 120px;
}

.curved {
    position: fixed;
    inset: 0;
    transform-style: preserve-3d;
    transform: perspective(1000px) translateZ(calc(-200px * var(--curve-k))) scale(calc(1 + var(--curve-k) * 0.06));
    will-change: transform;
    z-index: var(--z-content);
}

.parallax-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.text-layer {
    position: relative;
    z-index: 10;
    padding: 15vh 8vw 25vh;
    max-width: 99%;
    margin: 0 auto;
    transform-style: preserve-3d;
    will-change: transform;
    transition: transform 0.1s linear;
}

.image-layer {
    position: fixed;
    inset: 0;
    z-index: 5;
    pointer-events: none;
    transform-style: preserve-3d;
    will-change: transform;
    transition: transform 0.1s linear;
}

.stream {
    font-size: clamp(18px, 2.5vw, 32px);
    line-height: 1.8;
    letter-spacing: -0.01em;
    max-width: 100%;
    color: rgba(255, 255, 255, 0.85);
}

.sentence {
    display: inline;
    transition: opacity 0.3s ease, color 0.3s ease;
    cursor: none;
    position: relative;
    z-index: 2;
    letter-spacing: -0.01em;
}

.sentence.active {
    color: #fff;
    opacity: 1;
    text-shadow: 0 0 20px rgba(218, 165, 32, 0.3);
    background: rgba(0, 0, 0, 0.85);
    padding: 2px 6px;
    border-radius: 2px;
}

.sentence.dimmed {
    opacity: 0.4;
    color: rgba(255, 255, 255, 0.5);
}

.post-break {
    display: block;
    margin: 4em 0 3em;
    padding: 2em 0;
    border-top: 2px solid rgba(218, 165, 32, 0.3);
    border-bottom: 2px solid rgba(218, 165, 32, 0.3);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto;
    background: rgba(218, 165, 32, 0.02);
}

.post-break:hover {
    background: rgba(218, 165, 32, 0.08);
    padding: 2em 1em;
}

.post-break-header {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--ink-3);
    margin-bottom: 1em;
}

.post-break-title {
    font-family: 'Crimson Text', serif;
    font-size: 24px;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 0.5em;
    letter-spacing: 0.02em;
}

.post-break-author {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--ink-2);
    letter-spacing: 0.08em;
}

.post-break-meta {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--ink-3);
    margin-top: 1em;
    letter-spacing: 0.05em;
}

.bracket-trigger {
    all: unset;
    cursor: none;
    font-family: 'Space Mono', 'Courier New', monospace;
    font-size: 0.65em;
    color: var(--bracket-color);
    letter-spacing: 0.02em;
    transition: all 0.2s ease;
    border-bottom: 1px dotted rgba(139, 111, 71, 0.5);
    padding-bottom: 1px;
    display: inline;
    vertical-align: baseline;
    line-height: inherit;
    margin: 0 0.1em;
}

.bracket-trigger:hover {
    color: var(--bracket-hover);
    opacity: 1;
    border-bottom-color: var(--bracket-hover);
}

.bracket-trigger.expanded {
    opacity: 0.5;
}

.bracket-content {
    display: inline;
    font-size: 0.8em;
    color: rgba(184, 184, 184, 0.8);
    font-style: italic;
    line-height: inherit;
    padding-left: 0.2em;
    margin-left: 0.2em;
    border-left: 1px solid rgba(218, 165, 32, 0.5);
    padding-right: 0.2em;
    background: rgba(218, 165, 32, 0.02);
    animation: bracketFadeIn 0.3s ease-out;
}

@keyframes bracketFadeIn {
    from { opacity: 0; transform: translateY(-4px); }
    to { opacity: 1; transform: translateY(0); }
}

.image-trigger {
    position: relative;
    text-decoration: none;
    border-bottom: 1px dotted var(--accent);
    cursor: help;
    transition: all 0.2s ease;
    opacity: 0.9;
}

.image-trigger:hover {
    color: var(--accent);
    border-bottom-style: solid;
    opacity: 1;
}

.hover-image {
    position: absolute;
    z-index: 1;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.4s cubic-bezier(0.25, 1, 0.5, 1), transform 0.1s linear;
    width: 1400px;
    height: 1050px;
    border-radius: 8px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    transform: translate(-50%, -50%) scale(0.95);
    filter: brightness(0.9) contrast(1.05);
    will-change: transform, opacity;
    left: 50%;
    top: 50%;
}

.hover-image.active {
    opacity: 0.6;
    transform: translate(-50%, -50%) scale(1);
}

.hover-image img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 8px;
}

#cursorImage {
    position: fixed;
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    opacity: 0;
    transition: opacity 0.3s ease, width 0.3s ease, height 0.3s ease;
    border-radius: 4px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    width: 400px;
    height: 300px;
    object-fit: cover;
    display: none;
}

#cursorImage.active { opacity: 1; }
#cursorImage.enlarged { width: 600px; height: 450px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); }

.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: var(--z-ui);
    padding: clamp(16px, 2vh, 28px) clamp(20px, 4vw, 50px);
    display: flex;
    justify-content: space-between;
    align-items: center;
    pointer-events: none;
}

.brand-container {
    position: relative;
    pointer-events: auto;
    display: flex;
    align-items: center;
    gap: 16px;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 12px;
}

.brand {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--ink-3);
    padding: 6px 10px;
    border-radius: 3px;
    transition: all 0.2s ease;
    text-decoration: none;
    background: rgba(255, 255, 255, 0.015);
    border: 1px solid rgba(255, 255, 255, 0.06);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}

.brand:hover {
    background: rgba(255, 255, 255, 0.04);
    color: var(--ink);
    border-color: var(--accent);
}

.brand:active { transform: scale(0.95); }

.brand-dropdown-icon { font-size: 10px; transition: transform 0.2s ease; }
.brand.open .brand-dropdown-icon { transform: rotate(180deg); }

.post-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    min-width: 320px;
    background: rgba(10, 10, 10, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 8px 0;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    z-index: var(--z-dropdown);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    max-height: 70vh;
    display: flex;
    flex-direction: column;
}

.post-dropdown.open { opacity: 1; visibility: visible; transform: translateY(0); }

.post-dropdown-header {
    padding: 12px 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    margin-bottom: 8px;
    flex-shrink: 0;
}

.post-dropdown-header h3 {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink-3);
    margin: 0;
    font-weight: 400;
}

.post-dropdown-list {
    overflow-y: auto;
    padding: 0;
    margin: 0;
    list-style: none;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
}

.post-dropdown-list::-webkit-scrollbar { width: 4px; }
.post-dropdown-list::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
.post-dropdown-list::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.15); border-radius: 2px; }

.post-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.post-item:hover { background: rgba(218, 165, 32, 0.08); }
.post-item.active { background: rgba(218, 165, 32, 0.12); border-left: 2px solid var(--accent); }

.post-item-title {
    font-family: 'Crimson Text', serif;
    font-size: 15px;
    color: var(--ink-2);
    font-weight: 500;
}

.post-item.active .post-item-title { color: var(--accent); }

.post-item-meta {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--ink-3);
    letter-spacing: 0.05em;
}

.preview-toggle, .layout-toggle { pointer-events: auto; }

.preview-button, .layout-button, .action-button {
    background: rgba(255, 255, 255, 0.015);
    border: 1px solid rgba(255, 255, 255, 0.06);
    padding: 8px 12px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--ink-3);
    gap: 6px;
    pointer-events: auto;
}

.preview-button:hover, .layout-button:hover, .action-button:hover {
    background: rgba(255, 255, 255, 0.04);
    border-color: rgba(255, 255, 255, 0.12);
}

.preview-button:active, .layout-button:active, .action-button:active { transform: scale(0.95); }
.preview-button.active { border-color: var(--accent); color: var(--accent); }

.layout-icon {
    width: 24px;
    height: 20px;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.layout-icon.layered::before, .layout-icon.layered::after {
    content: '';
    display: block;
    width: 100%;
    height: 6px;
    background: var(--ink-3);
    border-radius: 1px;
    transition: all 0.3s ease;
}

.layout-icon.layered::after { opacity: 0.5; margin-top: -4px; }

.layout-icon.split::before, .layout-icon.split::after {
    content: '';
    display: block;
    border-radius: 1px;
    transition: all 0.3s ease;
}

.layout-icon.split::before { width: 10px; height: 100%; background: var(--ink-3); }
.layout-icon.split::after { width: 10px; height: 100%; background: var(--ink-3); margin-left: 4px; opacity: 0.5; }

/* Post Metadata Footer */
.post-metadata {
    margin-top: 3em;
    padding-top: 2em;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.post-info {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.post-author-link {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    text-decoration: none;
    letter-spacing: 0.05em;
    transition: all 0.2s ease;
}

.post-author-link:hover {
    color: var(--ink);
}

.post-timestamp {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--ink-3);
    letter-spacing: 0.05em;
}

.post-actions {
    display: flex;
    align-items: center;
    gap: 16px;
}

.post-action-btn {
    background: transparent;
    border: none;
    color: var(--ink-3);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    padding: 6px 10px;
    border-radius: 3px;
}

.post-action-btn:hover {
    color: var(--accent);
    background: rgba(218, 165, 32, 0.08);
}

.post-action-btn.active {
    color: var(--accent);
}

.post-action-icon {
    font-size: 16px;
}

#cursor {
    position: fixed;
    width: 20px;
    height: 20px;
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    transition: width 0.25s, height 0.25s, background-color 0.25s, border-color 0.25s, opacity 0.25s;
    mix-blend-mode: difference;
}

#cursor.hovering {
    width: 36px;
    height: 36px;
    background-color: rgba(255, 255, 255, 0.08);
    border-color: var(--accent);
}

#cursor.pointer { width: 14px; height: 14px; background-color: rgba(255, 255, 255, 0.7); }
#cursor.has-image { opacity: 0; }

.scroll-hint {
    position: fixed;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    z-index: var(--z-ui);
    opacity: 0;
    animation: fadeInOut 4s ease-in-out;
    pointer-events: none;
}

.scroll-hint-icon {
    width: 24px;
    height: 24px;
    border-right: 2px solid rgba(255, 255, 255, 0.4);
    border-bottom: 2px solid rgba(255, 255, 255, 0.4);
    transform: rotate(45deg);
    animation: bounce 1.5s ease-in-out infinite;
}

.scroll-hint-text {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink-3);
}

@keyframes bounce {
    0%, 100% { transform: rotate(45deg) translateY(0); }
    50% { transform: rotate(45deg) translateY(8px); }
}

@keyframes fadeInOut {
    0%, 100% { opacity: 0; }
    20%, 80% { opacity: 1; }
}

@media (max-width: 768px) {
    .scroll-progress { display: none; }
    .left-rail { display: flex; }
    .mobile-bottom-rail { display: flex; }
    .scroll-hint { display: none; }
    .text-layer { padding: 12vh 6vw 20vh 50px; max-width: 95%; }
    .stream { font-size: clamp(16px, 4vw, 28px); }
    .hover-image { width: 800px; height: 600px; }
    .post-dropdown { min-width: 280px; left: -10px; }
    
    body.layout-split .text-layer { width: 100%; padding-left: 50px; padding-right: 20px; }
    body.layout-split .hover-image {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 800px;
        height: 600px;
        transform: translate(-50%, -50%) scale(0.95);
    }
    #cursor { display: none; }
    * { -webkit-tap-highlight-color: rgba(218, 165, 32, 0.2); }
    .nav-button { -webkit-tap-highlight-color: rgba(218, 165, 32, 0.3); }
}

@media (prefers-reduced-motion: reduce) {
    .edge-blur { backdrop-filter: none; -webkit-backdrop-filter: none; }
    * { animation: none !important; transition: none !important; }
}
    </style>

</head>
<body>
    <div id="cursor" aria-hidden="true"></div>
    <img id="cursorImage" alt="Preview" aria-hidden="true">
    
    <div class="left-rail" aria-hidden="true">
        <div class="lens-control-container">
            <span class="lens-label">Lens</span>
            <div class="lens-slider-wrapper">
                <input 
                    type="range" 
                    class="lens-slider" 
                    id="lensSlider"
                    min="0" 
                    max="1" 
                    step="0.01" 
                    value="1"
                    aria-label="Adjust lens curvature effect"
                >
            </div>
        </div>
    </div>
    
    <div class="mobile-bottom-rail" aria-label="Mobile navigation">
        <div class="mobile-nav-container">
            <div class="mobile-nav-group">
                <button class="mobile-nav-button" id="mobilePrevSentenceBtn" 
                        title="Previous Sentence" aria-label="Previous Sentence">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
                        </svg>
                </button>
                <span class="mobile-nav-label">Prev</span>
            </div>
            
            <div class="mobile-progress-container">
                <span class="mobile-progress-text" id="mobileProgressText">0 / 0</span>
                <div class="mobile-progress-bar">
                    <div class="mobile-progress-fill" id="mobileProgressFill"></div>
                </div>
            </div>
            
            <div class="mobile-nav-group">
                <button class="mobile-nav-button" id="mobileNextSentenceBtn" 
                        title="Next Sentence" aria-label="Next Sentence">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                        </svg>
                </button>
                <span class="mobile-nav-label">Next</span>
            </div>
        </div>
    </div>
    
    <header class="header">
        <div class="brand-container">
            <div class="brand" id="anthologyLogo">
                <span>Anthology</span>
            </div>
            
            <div class="brand" id="profileToggle" aria-label="Open post menu">
                <span id="currentProfileName">@zackgort</span>
                <span class="brand-dropdown-icon">‚ñº</span>
            </div>
            <div class="post-dropdown" id="postDropdown" aria-hidden="true">
                <div class="post-dropdown-header">
                    <h3>Your Posts</h3>
                </div>
                <ul class="post-dropdown-list" id="postDropdownList">
                </ul>
            </div>
        </div>

        <div class="header-right">
            <button class="action-button" id="composeBtn">
                <span>‚úé</span>
                <span>Compose</span>
            </button>
            
            <div class="preview-toggle">
                <button 
                    id="previewToggle" 
                    class="preview-button"
                    aria-label="Toggle image preview mode"
                    title="Switch between background and cursor preview (P)"
                >
                    <span>üñºÔ∏è</span>
                    <span id="previewModeText">BG</span>
                </button>
            </div>
            
            <div class="layout-toggle">
                <button 
                    id="layoutToggle" 
                    class="layout-button"
                    aria-label="Toggle layout mode"
                    title="Switch between layered and split layout"
                >
                    <span class="layout-icon layered"></span>
                </button>
            </div>
        </div>
    </header>

    <div class="edge-blur" aria-hidden="true"></div>
    <div class="vignette" aria-hidden="true"></div>

    <div class="scroll-progress" aria-label="Navigation controls">
        <button class="nav-button prev-post" id="prevPostBtn" title="Previous Post ([)" aria-label="Previous Post">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M15.41 7.41L10.83 12l4.58 4.59L14 18l-6-6 6-6 1.41 1.41z"/>
            </svg>
        </button>
        
        <button class="nav-button prev-sentence" id="prevSentenceBtn" title="Previous Sentence (‚Üë/k)" aria-label="Previous Sentence">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"/>
            </svg>
        </button>
        
        <div class="scroll-progress-bar-container">
            <div class="scroll-progress-bar" id="scrollProgressBar"></div>
        </div>
        
        <button class="nav-button next-sentence" id="nextSentenceBtn" title="Next Sentence (‚Üì/j)" aria-label="Next Sentence">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
            </svg>
        </button>
        
        <button class="nav-button next-post" id="nextPostBtn" title="Next Post (])" aria-label="Next Post">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
            </svg>
        </button>
    </div>

    <div class="scroll-hint" aria-hidden="true">
        <div class="scroll-hint-icon"></div>
        <span class="scroll-hint-text">Navigate ¬∑ Press P ¬∑ Explore</span>
    </div>

    <main class="curved">
        <div class="parallax-container">
            <div id="imageLayer" class="image-layer">
                <div id="hoverImage" class="hover-image" role="tooltip" aria-hidden="true">
                    <img src="" alt="" id="hoverImageImg" loading="lazy">
                </div>
            </div>
            
            <div id="textLayer" class="text-layer">
                <article class="stream" id="stream" role="article"></article>
            </div>
        </div>
    </main>

    <script>
// Logic Constants
const CURSOR_SMOOTHING = 0.35;
const IMAGE_HOVER_DELAY = 120;
const TEXT_PARALLAX_STRENGTH = 0.03;
const IMAGE_PARALLAX_STRENGTH = 0.15;
const CENTER_MAGNET_STRENGTH = 0.25;
const PARALLAX_DAMPING = 0.1;
const SCROLL_THRESHOLD = 30;
const SCROLL_COOLDOWN = 100;
let scrollCooldownActive = false;
let spacebarPressed = false;

// Touch variables
let touchStartY = 0;
let touchStartTime = 0;
let isLongPress = false;
let longPressTimer = null;
let touchMoved = false;
const LONG_PRESS_DURATION = 500;
const FLICK_THRESHOLD = 50;

// Sample Posts Data
const posts = [
    {
        id: 1,
        author: "@zackgort",
        authorName: "Zack Gort",
        title: "Twenty Years of Bootstrap Design",
        timestamp: "2h ago",
        narrative: `Most portfolios treat "the work" as the hero. But what if "the story" is the true hero? [Before I was a UX Designer, I was a Web Designer. Before I was a web designer, I was a Graphic Designer. Before I was a graphic designer, I was a teenager who could draw well and had a passion for animation.] What is UX? It is that which is in motion. It is that which necessitates forethought into the next step while maintaining a frame of reference for that which has occurred. [I didn't graduate from college. I couldn't afford it. Pratt Institute of Art was expensive, and loans or financial aid were simply out of reach.] But over the last fifteen-plus years, I've expanded these basic skills into a meaningful career. A non-linear, but carefully curated path from homegrown startups to working with A-list brands at a global scale.`,
        images: {
            'Pratt Institute': 'https://i.ibb.co/r2nhMymB/1-Dkcm-PIZj6ro-ZML4w2k-Nk-Mw.webp',
            'art school': 'https://i.ibb.co/r2nhMymB/1-Dkcm-PIZj6ro-ZML4w2k-Nk-Mw.webp',
            'A-list brands': 'https://i.ibb.co/840YDJMT/1-6ft-VCi9-Pi-L1q47-Vskw-Mb-WA.webp'
        }
    },
    {
        id: 2,
        author: "@sarahchen",
        authorName: "Sarah Chen",
        title: "On Building in Public",
        timestamp: "5h ago",
        narrative: `The best marketing isn't marketing at all. [It's transparency. It's vulnerability. It's showing your process, not just your polish.] I've been building digital products for eight years, and only recently discovered the power of working in the open. Sharing wireframes before they're perfect. [Posting about failures, not just wins.] Inviting criticism while the clay is still wet. This shift changed everything. My network grew. Opportunities appeared. [But more importantly, I became a better designer because I was accountable to an audience that cared.] The internet rewards those who share generously.`,
        images: {
            'transparency': 'https://i.ibb.co/nNLv6NKB/1-CQ-4u-Tk-D6-MUBWABKw-JIZg-A.webp',
            'wireframes': 'https://i.ibb.co/Y49DcPw2/1-KE8g-FA6w4wud1u-DAr-A4-Yv-Q.webp',
            'network': 'https://i.ibb.co/sJkpkV9Q/1-l4jg-O1-4g-Ey-Wy-IBEQZho0g.webp'
        }
    },
    {
        id: 3,
        author: "@marcuswright",
        authorName: "Marcus Wright",
        title: "The Lens of Curiosity",
        timestamp: "1d ago",
        narrative: `Photography taught me to see design differently. [Every frame is a composition. Every shadow tells a story. Every negative space is intentional.] When I pick up my camera, I'm not just capturing reality‚ÄîI'm making choices about what matters. What to emphasize. What to obscure. [This mindset translates directly to product design.] What information deserves the foreground? What can live in the background? Where should the eye rest first? Photography is design with light. Design is photography with pixels. [Both require the same fundamental skill: deciding what to show, and what to hide.]`,
        images: {
            'camera': 'https://i.ibb.co/tP1YpWFG/1-f-R6-Yh5w77l-Iv-Sg-R4ldzj-TA.webp',
            'composition': 'https://i.ibb.co/9mcrj9tg/1-h9lj-VOzz-RT-Irakga-DSWv-Q.webp',
            'product design': 'https://i.ibb.co/VYpfVW1J/1-q6-XH2u-HTIVh-Nd-NY0ab-XW3g.webp'
        }
    }
];

const state = {
    currentPostIndex: 0,
    hoveredSentence: null,
    expandedBrackets: new Set(),
    mouseX: 0,
    mouseY: 0,
    imageTimeout: null,
    imageActive: false,
    currentTriggerRect: null,
    layoutMode: 'layered',
    currentSentenceIndex: -1,
    allSentenceElements: [],
    postStartIndices: [],
    previewMode: 'background',
    likes: new Set([1]), // Sample: post 1 is liked
    bookmarks: new Set([2]) // Sample: post 2 is bookmarked
};

let mouseX = 0;
let mouseY = 0;
let currentImageElement = null;

let textParallaxX = 0;
let textParallaxY = 0;
let targetTextParallaxX = 0;
let targetTextParallaxY = 0;

let imageParallaxX = 0;
let imageParallaxY = 0;
let targetImageParallaxX = 0;
let targetImageParallaxY = 0;

function getCurrentPost() {
    if (state.allSentenceElements.length === 0) return 0;
    
    for (let i = posts.length - 1; i >= 0; i--) {
        const postStartIndex = state.postStartIndices[i];
        if (state.currentSentenceIndex >= postStartIndex) {
            return i;
        }
    }
    return 0;
}

function parseNarrative(text) {
    const parts = [];
    let idCounter = 0;
    
    const segments = text.split(/(\[|\])/);
    
    let inBracket = false;
    let bracketId = null;
    
    for (let i = 0; i < segments.length; i++) {
        const segment = segments[i];
        
        if (segment === '[') {
            inBracket = true;
            bracketId = idCounter++;
            parts.push({
                type: 'bracket',
                id: bracketId,
                content: ''
            });
        } else if (segment === ']') {
            inBracket = false;
            bracketId = null;
        } else if (segment.length > 0) {
            if (inBracket && bracketId !== null) {
                const bracket = parts.find(p => p.id === bracketId);
                if (bracket) {
                    bracket.content = segment.trim();
                }
            } else {
                const sentences = segment.split(/(?<=[.!?])\s+/);
                sentences.forEach(sentence => {
                    if (sentence.trim()) {
                        parts.push({
                            type: 'sentence',
                            id: idCounter++,
                            text: sentence.trim()
                        });
                    }
                });
            }
        }
    }
    
    return parts;
}

function wrapImageTriggers(text, imageMap) {
    let wrapped = text;
    for (const [phrase, url] of Object.entries(imageMap)) {
        const escapedPhrase = phrase.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const regex = new RegExp(`\\b${escapedPhrase}\\b`, 'gi');
        wrapped = wrapped.replace(regex, `<span class="image-trigger" data-image="${url}">$&</span>`);
    }
    return wrapped;
}

function preloadImages() {
    posts.forEach(post => {
        Object.values(post.images).forEach(url => {
            const img = new Image();
            img.src = url;
        });
    });
}

function togglePreviewMode() {
    state.previewMode = state.previewMode === 'background' ? 'cursor' : 'background';
    
    const previewModeText = document.getElementById('previewModeText');
    const previewButton = document.getElementById('previewToggle');
    const body = document.body;
    
    if (state.previewMode === 'cursor') {
        body.classList.add('cursor-preview-mode');
        previewModeText.textContent = 'CUR';
        previewButton.classList.add('active');
    } else {
        body.classList.remove('cursor-preview-mode');
        previewModeText.textContent = 'BG';
        previewButton.classList.remove('active');
    }
    
    const currentUrl = state.imageActive ? document.getElementById('hoverImageImg').src : null;
    if (currentUrl && currentImageElement) {
        hideImage();
        setTimeout(() => {
            showImage(currentUrl, currentImageElement);
        }, 50);
    }
}

function showImage(imageUrl, triggerElement) {
    currentImageElement = triggerElement;
    state.imageActive = true;
    state.currentTriggerRect = triggerElement.getBoundingClientRect();
    
    document.body.classList.add('image-active');
    
    if (state.previewMode === 'cursor') {
        const cursorImage = document.getElementById('cursorImage');
        const cursor = document.getElementById('cursor');
        
        cursorImage.src = imageUrl;
        cursorImage.classList.add('active');
        cursor.classList.add('has-image');
    } else {
        const hoverImage = document.getElementById('hoverImage');
        const hoverImageImg = document.getElementById('hoverImageImg');
        
        if (state.imageTimeout) {
            clearTimeout(state.imageTimeout);
        }
        
        state.imageTimeout = setTimeout(() => {
            hoverImageImg.onload = () => {
                hoverImage.classList.add('active');
            };
            
            hoverImageImg.onerror = () => {
                hoverImage.classList.add('active');
            };
            
            hoverImageImg.src = imageUrl;
        }, IMAGE_HOVER_DELAY);
    }
}

function hideImage() {
    const hoverImage = document.getElementById('hoverImage');
    const cursorImage = document.getElementById('cursorImage');
    const cursor = document.getElementById('cursor');
    
    clearTimeout(state.imageTimeout);
    hoverImage.classList.remove('active');
    cursorImage.classList.remove('active');
    cursorImage.classList.remove('enlarged');
    cursor.classList.remove('has-image');
    
    document.body.classList.remove('image-active');
    
    state.imageActive = false;
    currentImageElement = null;
    state.currentTriggerRect = null;
}

function toggleImageSize() {
    if (!state.imageActive || state.previewMode !== 'cursor') return;
    
    const cursorImage = document.getElementById('cursorImage');
    cursorImage.classList.toggle('enlarged');
}

function isDropdownOpen() {
    return document.getElementById('postDropdown').classList.contains('open');
}

function handleScroll(event) {
    if (scrollCooldownActive) return;
    
    if (isDropdownOpen()) {
        const dropdown = document.getElementById('postDropdown');
        if (!dropdown.contains(event.target)) {
             event.preventDefault();
        }
        return; 
    }
    
    const scrollDelta = event.deltaY;
    
    if (Math.abs(scrollDelta) >= SCROLL_THRESHOLD) {
        scrollCooldownActive = true;
        
        if (scrollDelta > 0) {
            nextSentence();
        } else {
            previousSentence();
        }
        
        setTimeout(() => {
            scrollCooldownActive = false;
        }, SCROLL_COOLDOWN);
    }
    
    event.preventDefault();
}

function handleTouchStart(e) {
    touchStartY = e.touches[0].clientY;
    touchStartTime = Date.now();
    touchMoved = false;
    
    longPressTimer = setTimeout(() => {
        isLongPress = true;
        document.body.style.overflow = 'auto';
        const textLayer = document.querySelector('.text-layer');
        if (textLayer) {
            textLayer.style.overflow = 'visible';
        }
    }, LONG_PRESS_DURATION);
}

function handleTouchMove(e) {
    touchMoved = true;
    
    if (isLongPress) {
        return;
    }
    
    if (isDropdownOpen()) {
         const dropdown = document.getElementById('postDropdown');
         if (!dropdown.contains(e.target)) {
             e.preventDefault();
         }
         return;
    }
    
    e.preventDefault();
}

function handleTouchEnd(e) {
    if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
    }
    
    if (isLongPress) {
        isLongPress = false;
        document.body.style.overflow = 'hidden';
        const textLayer = document.querySelector('.text-layer');
        if (textLayer) {
            textLayer.style.overflow = 'visible';
        }
        return;
    }
    
    if (!touchMoved || scrollCooldownActive || isDropdownOpen()) {
        return;
    }
    
    const touchEndY = e.changedTouches[0].clientY;
    const deltaY = touchStartY - touchEndY;
    
    if (Math.abs(deltaY) > FLICK_THRESHOLD) {
        scrollCooldownActive = true;
        
        if (deltaY > 0) {
            nextSentence();
        } else {
            previousSentence();
        }
        
        setTimeout(() => {
            scrollCooldownActive = false;
        }, SCROLL_COOLDOWN);
    }
}

function nextSentence() {
    if (state.allSentenceElements.length === 0) return;
    
    state.currentSentenceIndex = (state.currentSentenceIndex + 1) % state.allSentenceElements.length;
    highlightSentence(state.currentSentenceIndex);
}

function previousSentence() {
    if (state.allSentenceElements.length === 0) return;
    
    state.currentSentenceIndex = (state.currentSentenceIndex - 1 + state.allSentenceElements.length) % state.allSentenceElements.length;
    highlightSentence(state.currentSentenceIndex);
}

function highlightSentence(index) {
    const sentence = state.allSentenceElements[index];
    if (!sentence) return;
    
    state.allSentenceElements.forEach(s => {
        s.classList.remove('active');
        s.classList.add('dimmed');
    });
    
    sentence.classList.add('active');
    sentence.classList.remove('dimmed');
    
    updateScrollProgress();
    updatePostDropdown();
    
    sentence.scrollIntoView({
        behavior: 'smooth',
        block: 'center'
    });
    
    const imageTrigger = sentence.querySelector('.image-trigger');
    if (imageTrigger) {
        const imageUrl = imageTrigger.getAttribute('data-image');
        if (imageUrl) {
            showImage(imageUrl, imageTrigger);
        }
    } else {
        hideImage();
    }
}

function goToPost(postIndex) {
    const startIndex = state.postStartIndices[postIndex];
    if (startIndex !== undefined) {
        state.currentPostIndex = postIndex;
        state.currentSentenceIndex = startIndex;
        highlightSentence(startIndex);
        closePostDropdown();
        updateCurrentProfile();
    }
}

function nextPost() {
    const currentPost = getCurrentPost();
    if (currentPost < posts.length - 1) {
        goToPost(currentPost + 1);
    }
}

function previousPost() {
    const currentPost = getCurrentPost();
    if (currentPost > 0) {
        goToPost(currentPost - 1);
    }
}

function updateScrollProgress() {
    const progressBar = document.getElementById('scrollProgressBar');
    const mobileProgressFill = document.getElementById('mobileProgressFill');
    const mobileProgressText = document.getElementById('mobileProgressText');
    
    const total = state.allSentenceElements.length;
    const current = state.currentSentenceIndex + 1;
    const progress = (current / total) * 100;
    
    if (progressBar) {
        progressBar.style.height = `${progress}%`;
    }
    
    if (mobileProgressFill) {
        mobileProgressFill.style.width = `${progress}%`;
    }
    
    if (mobileProgressText) {
        mobileProgressText.textContent = `${current} / ${total}`;
    }
}

function updateParallax() {
    const viewportCenterX = window.innerWidth / 2;
    const viewportCenterY = window.innerHeight / 2;
    
    const mouseOffsetX = (mouseX - viewportCenterX) / viewportCenterX;
    const mouseOffsetY = (mouseY - viewportCenterY) / viewportCenterY;
    
    targetTextParallaxX = mouseOffsetX * 20 * TEXT_PARALLAX_STRENGTH;
    targetTextParallaxY = mouseOffsetY * 20 * TEXT_PARALLAX_STRENGTH;
    
    if (state.imageActive && state.currentTriggerRect) {
        const trigger = state.currentTriggerRect;
        const triggerCenterX = trigger.left + trigger.width / 2;
        const triggerCenterY = trigger.top + trigger.height / 2;
        
        const distToCenterX = (viewportCenterX - triggerCenterX) / viewportCenterX;
        const distToCenterY = (viewportCenterY - triggerCenterY) / viewportCenterY;
        
        const magnetX = distToCenterX * CENTER_MAGNET_STRENGTH * 100;
        const magnetY = distToCenterY * CENTER_MAGNET_STRENGTH * 100;
        
        const parallaxX = mouseOffsetX * 100 * IMAGE_PARALLAX_STRENGTH;
        const parallaxY = mouseOffsetY * 100 * IMAGE_PARALLAX_STRENGTH;
        
        targetImageParallaxX = parallaxX - magnetX;
        targetImageParallaxY = parallaxY - magnetY;
    } else {
        targetImageParallaxX = 0;
        targetImageParallaxY = 0;
    }
    
    textParallaxX += (targetTextParallaxX - textParallaxX) * PARALLAX_DAMPING;
    textParallaxY += (targetTextParallaxY - textParallaxY) * PARALLAX_DAMPING;
    
    imageParallaxX += (targetImageParallaxX - imageParallaxX) * PARALLAX_DAMPING;
    imageParallaxY += (targetImageParallaxY - imageParallaxY) * PARALLAX_DAMPING;
    
    const textLayer = document.getElementById('textLayer');
    const imageLayer = document.getElementById('imageLayer');
    
    if (textLayer) {
        textLayer.style.transform = `translate3d(${textParallaxX}px, ${textParallaxY}px, 0)`;
    }
    
    if (imageLayer) {
        imageLayer.style.transform = `translate3d(${imageParallaxX}px, ${imageParallaxY}px, 0)`;
    }
    
    requestAnimationFrame(updateParallax);
}

function buildPostDropdown() {
    const dropdownList = document.getElementById('postDropdownList');
    dropdownList.innerHTML = '';
    
    posts.forEach((post, index) => {
        const li = document.createElement('li');
        li.className = 'post-item';
        li.dataset.postId = index;
        li.innerHTML = `
            <span class="post-item-title">${post.title}</span>
            <span class="post-item-meta">${post.timestamp}</span>
        `;
        
        li.addEventListener('click', () => {
            goToPost(index);
        });
        
        dropdownList.appendChild(li);
    });
}

function updatePostDropdown() {
    const currentPost = getCurrentPost();
    const items = document.querySelectorAll('.post-item');
    
    items.forEach(item => {
        const postId = parseInt(item.dataset.postId);
        if (postId === currentPost) {
            item.classList.add('active');
        } else {
            item.classList.remove('active');
        }
    });
}

function updateCurrentProfile() {
    const currentPost = getCurrentPost();
    const post = posts[currentPost];
    const profileName = document.getElementById('currentProfileName');
    if (profileName && post) {
        profileName.textContent = post.author;
    }
}

function togglePostDropdown() {
    const toggle = document.getElementById('profileToggle');
    const dropdown = document.getElementById('postDropdown');
    
    toggle.classList.toggle('open');
    dropdown.classList.toggle('open');
    
    if (dropdown.classList.contains('open')) {
        updatePostDropdown();
    }
}

function closePostDropdown() {
    const toggle = document.getElementById('profileToggle');
    const dropdown = document.getElementById('postDropdown');
    
    toggle.classList.remove('open');
    dropdown.classList.remove('open');
}

function toggleLike(postId) {
    if (state.likes.has(postId)) {
        state.likes.delete(postId);
    } else {
        state.likes.add(postId);
    }
    updatePostActions();
}

function toggleBookmark(postId) {
    if (state.bookmarks.has(postId)) {
        state.bookmarks.delete(postId);
    } else {
        state.bookmarks.add(postId);
    }
    updatePostActions();
}

function updatePostActions() {
    // This would update UI for like/bookmark states
    // For now just a placeholder
}

function render() {
    const streamEl = document.getElementById('stream');
    const fragment = document.createDocumentFragment();
    state.allSentenceElements = [];
    
    let sentenceCount = 0;
    state.postStartIndices = new Array(posts.length).fill(0);

    posts.forEach((post, postIndex) => {
        // Mark start index for this post
        state.postStartIndices[postIndex] = sentenceCount;
        
        // Post break divider (except for first post)
        if (postIndex > 0) {
            const postBreak = document.createElement('div');
            postBreak.className = 'post-break';
            postBreak.dataset.postId = postIndex;
            postBreak.innerHTML = `
                <div class="post-break-header">Next Post</div>
                <div class="post-break-title">${post.title}</div>
                <div class="post-break-author">by ${post.authorName}</div>
                <div class="post-break-meta">${post.timestamp}</div>
            `;
            postBreak.addEventListener('click', () => {
                goToPost(postIndex);
            });
            fragment.appendChild(postBreak);
        }
        
        const parsedContent = parseNarrative(post.narrative);
        
        parsedContent.forEach(part => {
            if (part.type === 'sentence') {
                const span = document.createElement('span');
                span.className = 'sentence';
                span.dataset.sentenceIndex = sentenceCount;
                span.dataset.postId = postIndex;
                span.style.cursor = 'pointer';
                
                const wrappedText = wrapImageTriggers(part.text, post.images);
                span.innerHTML = wrappedText + ' ';
                
                span.addEventListener('mouseenter', () => {
                    const index = parseInt(span.dataset.sentenceIndex);
                    state.allSentenceElements.forEach((s, i) => {
                        if (i === index) {
                            s.style.opacity = '0.7';
                        } else {
                            s.style.opacity = '0.25';
                        }
                    });
                }, { passive: true });
                
                span.addEventListener('mouseleave', () => {
                    state.allSentenceElements.forEach(s => {
                        s.style.opacity = '';
                    });
                }, { passive: true });
                
                span.addEventListener('click', () => {
                    const index = parseInt(span.dataset.sentenceIndex);
                    state.currentSentenceIndex = index;
                    highlightSentence(index);
                });
                
                state.allSentenceElements.push(span);
                sentenceCount++;
                fragment.appendChild(span);
            } else if (part.type === 'bracket') {
                const isExpanded = state.expandedBrackets.has(part.id);
                
                const trigger = document.createElement('button');
                trigger.className = 'bracket-trigger' + (isExpanded ? ' expanded' : '');
                trigger.textContent = '[' + (isExpanded ? '‚àí' : '+') + ']';
                
                trigger.addEventListener('click', () => {
                    if (state.expandedBrackets.has(part.id)) {
                        state.expandedBrackets.delete(part.id);
                    } else {
                        state.expandedBrackets.add(part.id);
                    }
                    render();
                });
                
                fragment.appendChild(trigger);
                
                if (isExpanded) {
                    const content = document.createElement('span');
                    content.className = 'bracket-content';
                    content.textContent = ' ' + part.content + ' ';
                    fragment.appendChild(content);
                }
            }
        });
        
        // Post metadata footer
        const metadata = document.createElement('div');
        metadata.className = 'post-metadata';
        metadata.innerHTML = `
            <div class="post-info">
                <a href="#" class="post-author-link">${post.authorName} ${post.author}</a>
                <div class="post-timestamp">${post.timestamp}</div>
            </div>
            <div class="post-actions">
                <button class="post-action-btn ${state.likes.has(post.id) ? 'active' : ''}" data-action="like" data-post-id="${post.id}">
                    <span class="post-action-icon">${state.likes.has(post.id) ? '‚ô•' : '‚ô°'}</span>
                    <span>Like</span>
                </button>
                <button class="post-action-btn ${state.bookmarks.has(post.id) ? 'active' : ''}" data-action="bookmark" data-post-id="${post.id}">
                    <span class="post-action-icon">${state.bookmarks.has(post.id) ? '‚òÖ' : '‚òÜ'}</span>
                    <span>Save</span>
                </button>
                <button class="post-action-btn" data-action="share" data-post-id="${post.id}">
                    <span class="post-action-icon">‚Üó</span>
                    <span>Share</span>
                </button>
            </div>
        `;
        
        // Add action listeners
        const likeBtn = metadata.querySelector('[data-action="like"]');
        const bookmarkBtn = metadata.querySelector('[data-action="bookmark"]');
        const shareBtn = metadata.querySelector('[data-action="share"]');
        
        likeBtn.addEventListener('click', () => toggleLike(post.id));
        bookmarkBtn.addEventListener('click', () => toggleBookmark(post.id));
        shareBtn.addEventListener('click', () => alert('Share functionality (mock)'));
        
        fragment.appendChild(metadata);
    });
    
    streamEl.innerHTML = '';
    streamEl.appendChild(fragment);
    
    buildPostDropdown();
    attachImageTriggerListeners();
    updateCurrentProfile();
}

function attachImageTriggerListeners() {
    const stream = document.getElementById('stream');
    stream.addEventListener('mouseover', handleImageHover, { passive: true });
    stream.addEventListener('mouseout', handleImageOut, { passive: true });
}

function handleImageHover(e) {
    const trigger = e.target.closest('.image-trigger');
    if (trigger) {
        const imageUrl = trigger.getAttribute('data-image');
        if (imageUrl) {
            showImage(imageUrl, trigger);
        }
    }
}

function handleImageOut(e) {
    const trigger = e.target.closest('.image-trigger');
    if (trigger) {
        hideImage();
    }
}

const cursor = document.getElementById('cursor');
const cursorImage = document.getElementById('cursorImage');
let cursorX = 0;
let cursorY = 0;
let targetX = 0;
let targetY = 0;

function updateCursor() {
    cursorX += (targetX - cursorX) * CURSOR_SMOOTHING;
    cursorY += (targetY - cursorY) * CURSOR_SMOOTHING;
    
    cursor.style.left = `${cursorX}px`;
    cursor.style.top = `${cursorY}px`;
    
    if (cursorImage) {
        cursorImage.style.left = `${cursorX}px`;
        cursorImage.style.top = `${cursorY}px`;
    }
    
    requestAnimationFrame(updateCursor);
}

document.addEventListener('mousemove', (e) => {
    targetX = e.clientX;
    targetY = e.clientY;
    mouseX = e.clientX;
    mouseY = e.clientY;
}, { passive: true });

document.addEventListener('mouseover', (e) => {
    if (e.target.matches('a, button, .image-trigger, input[type="range"], .post-break, .post-item')) {
        cursor.classList.add('hovering');
        if (e.target.matches('button, a')) {
            cursor.classList.add('pointer');
        }
    }
});

document.addEventListener('mouseout', (e) => {
    if (e.target.matches('a, button, .image-trigger, input[type="range"], .post-break, .post-item')) {
        cursor.classList.remove('hovering');
        cursor.classList.remove('pointer');
    }
});

const lensSlider = document.getElementById('lensSlider');
lensSlider.addEventListener('input', (e) => {
    const value = parseFloat(e.target.value);
    document.documentElement.style.setProperty('--curve-k', value);
});

const layoutToggle = document.getElementById('layoutToggle');
const layoutIcon = layoutToggle.querySelector('.layout-icon');
const profileToggle = document.getElementById('profileToggle');

function updateLayoutIcon() {
    if (state.layoutMode === 'layered') {
        layoutIcon.className = 'layout-icon layered';
    } else {
        layoutIcon.className = 'layout-icon split';
    }
}

profileToggle.addEventListener('click', () => {
    togglePostDropdown();
});

document.addEventListener('click', (e) => {
    const dropdown = document.getElementById('postDropdown');
    const toggle = document.getElementById('profileToggle');
    
    if (!toggle.contains(e.target) && !dropdown.contains(e.target)) {
        closePostDropdown();
    }
});

document.getElementById('prevSentenceBtn').addEventListener('click', () => {
    previousSentence();
});

document.getElementById('nextSentenceBtn').addEventListener('click', () => {
    nextSentence();
});

document.getElementById('prevPostBtn').addEventListener('click', () => {
    previousPost();
});

document.getElementById('nextPostBtn').addEventListener('click', () => {
    nextPost();
});

document.getElementById('mobilePrevSentenceBtn').addEventListener('click', () => {
    previousSentence();
});

document.getElementById('mobileNextSentenceBtn').addEventListener('click', () => {
    nextSentence();
});

document.getElementById('previewToggle').addEventListener('click', () => {
    togglePreviewMode();
});

document.getElementById('composeBtn').addEventListener('click', () => {
    alert('Compose mode (mock) - Would open elegant editor overlay');
});

document.getElementById('anthologyLogo').addEventListener('click', () => {
    alert('Anthology home feed (mock) - Would show curated/following feed');
});

layoutToggle.addEventListener('click', () => {
    state.layoutMode = state.layoutMode === 'layered' ? 'split' : 'layered';
    
    document.body.classList.remove('layout-layered', 'layout-split');
    document.body.classList.add(`layout-${state.layoutMode}`);
    
    updateLayoutIcon();
    
    document.body.style.transition = 'all 0.5s cubic-bezier(0.25, 1, 0.5, 1)';
    setTimeout(() => {
        document.body.style.transition = '';
    }, 500);
});

document.addEventListener('DOMContentLoaded', () => {
    preloadImages();
    render();
    updateCursor();
    updateParallax();
    
    document.body.classList.add(`layout-${state.layoutMode}`);
    updateLayoutIcon();
    
    window.addEventListener('wheel', handleScroll, { passive: false });
    
    window.addEventListener('touchstart', handleTouchStart, { passive: false });
    window.addEventListener('touchmove', handleTouchMove, { passive: false });
    window.addEventListener('touchend', handleTouchEnd, { passive: true });
    
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            e.preventDefault();
            if (!spacebarPressed) {
                toggleImageSize();
                spacebarPressed = true;
            }
        }
        
        if (e.key === 'p' || e.key === 'P') {
            e.preventDefault();
            togglePreviewMode();
        }
        
        switch(e.key) {
            case 'ArrowDown':
            case 'j':
                e.preventDefault();
                nextSentence();
                break;
            case 'ArrowUp':
            case 'k':
                e.preventDefault();
                previousSentence();
                break;
            case '[':
                e.preventDefault();
                previousPost();
                break;
            case ']':
                e.preventDefault();
                nextPost();
                break;
            case 'l':
                layoutToggle.click();
                break;
            case 'Escape':
                e.preventDefault();
                closePostDropdown();
                break;
        }
    });
    
    document.addEventListener('keyup', (e) => {
        if (e.code === 'Space') {
            spacebarPressed = false;
        }
    });
    
    if (state.allSentenceElements.length > 0) {
        state.currentSentenceIndex = 0;
        highlightSentence(0);
    }
    
    console.log('‚úì Anthology Social Platform ¬∑ Profile View');
});
    </script>
</body>
</html>
